# related: issue #511, #536


# When no ansible_python_interpreter is set, executor/module_common.py chooses
# "/usr/bin/python".
- name: integration/transport_config/python_path.yml
  hosts: tc-python-path-unset
  tasks:
  - meta: end_play
    when: not is_mitogen
  - mitogen_get_stack:
    register: out
  - assert_equal:
      left: out.result[0].kwargs.python_path
      right: ["/usr/bin/python"]


# Non-localhost with explicit ansible_python_interpreter
- hosts: tc-python-path-hostvar
  tasks:
  - meta: end_play
    when: not is_mitogen
  - mitogen_get_stack:
    register: out
  - assert_equal:
      left: out.result[0].kwargs.python_path
      right: [/hostvar/path/to/python]


# Implicit localhost gets ansible_python_interpreter=virtualenv interpreter
- hosts: localhost
  tasks:
  - meta: end_play
    when: not is_mitogen
  - mitogen_get_stack:
    register: out
  - assert_equal:
      left: out.result[0].kwargs.python_path
      right: ["{{ansible_playbook_python}}"]


# explicit local connections get the same treatment as everything else.
- hosts: tc-python-path-local-unset
  tasks:
  - meta: end_play
    when: not is_mitogen
  - mitogen_get_stack:
    register: out
  - assert_equal:
      left: out.result[0].kwargs.python_path
      right: ["/usr/bin/python"]


- hosts: tc-python-path-local-explicit
  tasks:
  - meta: end_play
    when: not is_mitogen
  - mitogen_get_stack:
    register: out
  - assert_equal:
      left: out.result[0].kwargs.python_path
      right: ["/a/b/c"]
