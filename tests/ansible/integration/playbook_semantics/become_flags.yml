# This must be run with FOO=2 set in the environment.

#
# Test sudo_flags respects -E.
#

- hosts: all
  any_errors_fatal: true
  tasks:
    - name: "without -E"
      become: true
      shell: "echo $FOO"
      register: out

    - assert:
        that: "out.stdout == ''"

- hosts: all
  any_errors_fatal: true
  become_flags: -E
  tasks:
    - name: "with -E"
      become: true
      shell: "set"
      register: out2

    - debug: msg={{out2}}
    - assert:
        that: "out2.stdout == '2'"
